
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <canvas width="500" height="500" style="background-color: blue;" id='c'></canvas>
</body>
<script>
  /** @type {HTMLCanvasElement} */ 
  const c = document.querySelector('#c')
  const canvas = c.getContext('2d')
  // Áî®Êï∞ÁªÑÂÇ®Â≠òüêçÁöÑË∫´‰Ωì x/y
  const snackBody = [
    [3, 6],
    [4, 6],
    [5, 6]
  ]
  // Âçï‰∏™ÁÇπÂç†ÁöÑÂÉèÁ¥†‰∏™Êï∞
  const spread = 25
  // Ê†ºÂ≠êÊï∞
  const size = 40
  // ÈÄüÂ∫¶
  const speed = 100
  // Âú∞ÂõæÂ§ßÂ∞è
  const map = spread * size
  c.width = map
  c.height = map
  // x, y 0: ‰∏ã/Âè≥Ôºå 1: '‰∏ä/Â∑¶'
  let direction = [1, 0]
  let food = generateFoods(size)
  let animate = null
  window.onload = () => {
    start(speed)
  }
  function start (timer) {
    if (animate) {
      clearInterval(animate)
    }
    animate = setInterval(() => {
      render(snackBody)
    }, timer)
  }
  function render (body) {
      const length = body.length
      for (let i = 0; i < length - 1; i++) {
        body[i][0] = body[i + 1][0]
        body[i][1] = body[i + 1][1]
      }
      // ÊúÄÂêé‰∏ÄÊà™ÊâãÂä®Êìç‰ΩúÔºåÊñπ‰æøË∞ÉÊï¥ÊñπÂêë
      body[length - 1][0] += direction[0]
      body[length - 1][1] += direction[1]
      canvas.clearRect(0, 0, map, map)
      
      for (let i = 0; i < length; i++) {
        // ÁªòÂà∂ËõáË∫´‰Ωì
        draw(body[i][0], body[i][1], 'white')
      }
      // Ê∏∏ÊàèÁªìÊùüÂà§ÂÆö
      check(body, map) && alert('game over')
      // Ê∏≤ÊüìÈ£üÁâ©
      draw(food[0], food[1], 'red')
  }

  // Âà§Êñ≠ËõáÁöÑË°åÂä®ÊòØÂê¶ÂêàÊ≥ï
  function check (body, map) {
    let head = body[body.length - 1]
    if (head[0] * spread >= map || head[1] * spread >= map || head[0] < 0 || head[1] < 0) {
      clearInterval(animate)
      return true
    }
    if (head[0] === food[0] && head[1] === food[1]) {
      // Âú®Á¨¨‰∏Ä‰ΩçÊèíÂÖ•‰∏ÄÊà™ÔºåÂõ†‰∏∫Ë∫´‰ΩìËÆ°ÁÆóÊòØÈÄöËøáÁ¨¨‰∏Ä‰ΩçÂ§ñÁöÑËÆ°ÁÆóÁöÑÔºåÊâÄ‰ª•Á¨¨‰∏Ä‰ΩçÊó†ËÆ∫ÊòØ‰ªÄ‰πàÈÉΩÂèØ‰ª•Ôºå‰∏ã‰∏ÄÂ∏ßÂ∞±‰ºöËÆ°ÁÆóÊõøÊç¢Êéâ‰∫Ü
      body.unshift([0, 0])
      food = generateFoods(size)
    }
    for (let i = 0; i < body.length - 1; i++ ) {
      head = body[body.length - 1]
      console.log(head, body);
      if (body[i][0] === head[0] && body[i][1] === head[1]) {
        clearInterval(animate)
        return true
      }
    }
  }

  
  function generateFoods (s) {
    // -1 Èò≤Ê≠¢Âá∫ÁïåÔºå ËøôÈáåÊ≤°ÊúâÂä†‰∏çËÉΩÂú®ËõáË∫´‰ΩìÂÜÖÁöÑÂà§Êñ≠ÔºåÂêéÁª≠ÂÜçÂä†
    const range = s - 1
    const foodPosition = [Math.ceil(Math.random(0, 1) * range), Math.ceil(Math.random(0, 1) * range)]
    console.log(range, foodPosition);
    return foodPosition
  }


  // ÁªòÂà∂ÂõæÂÉè ÂùêÊ†áÂíåÈ¢úËâ≤Ôºå
  function draw (x, y, color) {
    canvas.fillStyle = color
    canvas.fillRect(x * spread - 1, y * spread - 1, spread - 1 , spread - 1)
  }

  const DIRECTION = {
    RIGHT: 'ArrowRight',
    LEFT: 'ArrowLeft',
    UP: 'ArrowUp',
    DOWN: 'ArrowDown',
  }
  
  window.onkeydown = (e) => {
    // Èò≤Ê≠¢ÊªöÂä®È°µÈù¢
    e.preventDefault()
   switch (e.code) {
     case DIRECTION.LEFT: {
      if (direction[0] != 1) {
         direction = [-1, 0]
       }
       break
     }
     case DIRECTION.RIGHT: { 
      if (direction[0] != -1) {
         direction = [1, 0]
       }
       break
     }
     case DIRECTION.UP: {
      if (direction[1] != 1) {
         direction = [0, -1]
       }
       break
     }
     case DIRECTION.DOWN: {
      if (direction[1] != -1) {
         direction = [0, 1]
       }
       break
     }
   }
  }
</script>
</html>